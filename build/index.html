<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Create filament paintings with Filament Painter">
    <title>Filament Painter</title>
    <link rel="icon" type="image/png" href="./favicon-96x96-CA6u0CE8.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="./favicon-BOTxWJjj.svg" />
    <link rel="shortcut icon" href="./favicon-D7cH1iyJ.ico" />
  <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();class F0{constructor(){this._gl=null,this._canvas=null}get canvas(){if(this._canvas==null)throw new Error("Fetched canvas before initialisation");return this._canvas}set canvas(e){this._canvas=e}get gl(){if(this._gl==null)throw new Error("WebGL not supported on this browser");return this._gl}set gl(e){this._gl=e}}function A0(t,e){const n=new Float32Array(2);return n[0]=t,n[1]=e,n}function o0(t,e,n){const o=new Float32Array(3);return o[0]=t,o[1]=e,o[2]=n,o}class H0{constructor(e,n){this.x=e,this.y=n}}class _0{constructor(){this.pixelDimensions=new H0(0,0),this.physicalDimensions=A0(0,0)}}var H=(t=>(t[t.NEAREST=0]="NEAREST",t[t.GREYSCALE_MAX=1]="GREYSCALE_MAX",t[t.GREYSCALE_LUMINANCE=2]="GREYSCALE_LUMINANCE",t))(H||{});class B0{constructor(){this._image=new Image,this._sourceImage=new Image,this._filaments=[],this._heightFunction=0,this._computedResult=new Float32Array,this.startHeight=.2,this.endHeight=.2,this.increment=.08}get sourceImage(){return this._sourceImage}set sourceImage(e){this._sourceImage=e}get computedResult(){return this._computedResult}set computedResult(e){this._computedResult=e}get heightFunction(){return this._heightFunction}set heightFunction(e){this._heightFunction=e}get filaments(){return this._filaments}set filaments(e){this._filaments=e}get image(){if(this._image==null)throw new Error("No image selected");return this._image}set image(e){this._image=e}hasImage(){return this._image!=null}}class M0{constructor(){this._compute=new F0,this._export=new _0,this._paint=new B0}get compute(){return this._compute}get export(){return this._export}get paint(){return this._paint}}const s=new M0;function U0(t,e){const n=document.getElementById(t);if(!n){console.error(`Input element with ID '${t}' not found.`);return}n.addEventListener("change",o=>{var h;const a=(h=o.target.files)==null?void 0:h[0];if(!a){e({file:null,imageElement:null,error:"No file selected."});return}if(!a.type.startsWith("image/")){e({file:null,imageElement:null,error:"Selected file is not an image."});return}const l=new FileReader;l.onload=g=>{var L;const d=(L=g.target)==null?void 0:L.result,y=new Image;y.onload=()=>{e({file:a,imageElement:y,error:null})},y.onerror=()=>{e({file:a,imageElement:null,error:"Error loading the image."})},y.src=d},l.onerror=()=>{e({file:a,imageElement:null,error:"Error reading the file."})},l.readAsDataURL(a)})}const r0=[[[.12800918256125038,.15283220044122103,.29993729490827153,.3,.6947619535518205,.6999999976876498,.22000018245807607,.22000000000000003,.22000160487316103,.48,.48],[.20601088518333793,.021822218114664706,.09245764086598521,.29999999178994124,.2800000363581798,.280246651438982,.22000000007384632,.22000000000000003,.22000007876811126,.48,.48],[.029400751993559664,.2977395169944354,.29999881226228275,.49998245089139653,.27999999999999997,.28000000000000075,.22027450487852468,.2222202412398859,.39999999999870406,.4120395733834293,.48],[.3155948072538138,.30503306419746196,.31104807427089504,.4999688022833358,.49999586982827365,.07000080162706297,.3999999943394904,.4,.4,.4,.3999999999999989],[.3000009571240354,.3698854410835144,.2265254517697221,.4888561298791268,.498913031972681,.07000001740073693,.39999971389568895,.4,.4,.4,.400000000000003],[.2999999999962598,.3000000001634632,.10001418176826979,.10003928639896095,.17879428068889813,.12165623969547626,.40602023001008475,.4,.4,.4,.4000003673296005],[.6999632225318514,.30467076784157643,.10316122676995604,.10000125140461964,.10197273954851407,.44999988260038076,.45,.40080413128531966,.4,.4,.4],[.6308448703488435,.630666962831811,.30502479063062904,.3000043053022366,.30000034096665595,.3500000018149161,.35018586517529743,.4000090441802757,.4000000000013929,.4,.4],[.5335110764621709,.35577429245188574,.3000793047118755,.43675576211126116,.6399885084802373,.3500000000000037,.35000000000017595,.8199915606929233,.40321892376436164,.40000000070977226,.40000904467752624],[.39000202790308724,.30603819029041357,.3000000195700442,.4000004012913233,.5489713827510753,.5992952754327616,.3497698398460147,.47573599864120153,.5125281438231065,.4001291052292569,.49202695613009667],[.6305129012046996,.3354094443000289,.3969395824356498,.40000003238209814,.520237074172824,.6788000540627845,.10072756315349359,.30663460143118626,.4438763032613937,.8943665896140588,.6100211682907196]],[[.039303346821192096,.050262011722959764,.010437921851975928,.2999999999943597,.6125447617809896,.6726533336899974,.22333016849818513,.22000020902183745,.33999999835247624,.47999999998309617,.48],[.021709516218154673,.03015053658164272,.060152742309378254,.2925834070305403,.28000136782412516,.2816595349472185,.29656388265928696,.24165972279913228,.34000000001132064,.47422061358103174,.48],[.030040773460205335,.22268765637063825,.2680845248484919,.10237190783740599,.2755012620844025,.3562008895502094,.06000633865073743,.34999981738284663,.30790506069592705,.3000000000002132,.3000733772463066],[.300148805802826,.3000028822677257,.21678623786328985,.10036540661094327,.07000085036990891,.07000000000249514,.2998179421005452,.3999999952163577,.3999999996295624,.39765541082532485,.3000012476243415],[.3000009938604496,.3699999866510208,.18344649811219757,.4662767991713903,.15637852309124387,.07011807394658733,.3000000000003238,.39999989266124103,.40000000000000374,.4001315706936484,.49999999827893826],[.29835962464966126,.37560710577731826,.4660208425503643,.46999977456447845,.4439655228734407,.11633641768638038,.3001628748468885,.3998537937222261,.40000459206090316,.49999938339953814,.5],[.2282194438276368,.3901115516014665,.29970025628613417,.2000713458481812,.12000695836388943,.37053418568032065,.4499999999999993,.4499999999999881,.40000032430927873,.40001500629859293,.4997272330542989],[.6221328932430199,.7508477426658768,.30564041175028134,.4389210220146521,.29999970003526244,.3000209997088846,.44999606011816645,.39771691082220645,.40000339309563177,.40000000000052255,.40000000000000036],[.360924689723228,.3607507719785299,.4002485814866671,.47991752323310216,.639903724804715,.6393102901957864,.3517898869601387,.8195087228904016,.8199776776739748,.40122794588678845,.5999768789813347],[.31348901048431044,.3698662165784026,.29555686120952934,.6343261543764429,.6398563738370147,.7722960057272132,.5382259351285823,1.0999690440018504,.762854665015084,.5810421419895968,.5217006235976059],[.29521858712580373,.589876787304148,.6934324009491464,.3538908685436724,.6049990953515998,.9863783408660932,.5565184790825721,1.0995624655274931,.4522457112414787,.5798954893065948,.5100014342408407]],[[.010022097872704108,.13361342168437293,.10000000171542836,.30990626960152523,.39968611597057535,.33999310044378284,.3435317592559279,.25002538615752024,.33999735645058404,.34000000000000974,.4799999999999975],[.010000234091629425,.013034143302445698,.0889965536299284,.20651764082239032,.3523064918760262,.3599342715276536,.06191377402540161,.33971212957421887,.3399999998765325,.3039517913266444,.30001033133189137],[.019855096879658973,.13028990697483994,.18099415958407575,.0380567726167118,.3200738841002735,.3604766113604042,.3881661617498663,.3499999994565744,.303290753282168,.30000000000007987,.3],[.15792281847965878,.1799108359196561,.1798709964087586,.033663136124804885,.259070160532203,.0700883546492119,.4704061044928041,.34904997769123713,.30006968528660477,.3000000120084201,.3000815360095676],[.1292006914322277,.34159430091811605,.027721217834865922,.1572451071487649,.04691522194908764,.037894462336852834,.29999999992107723,.3000042523502326,.585186791495696,.5000000006582126,.5],[.060000756549619234,.5480306896538305,.5262888097725564,.326053006079747,.1358254370403017,.0760328124845731,.2999991463607341,.3020116566652525,.5996567047728696,.5000000332262733,.5],[.0600670268112593,.34562836156129656,.26081943853844247,.19962879882919035,.11908097405757219,.11128777736250908,.44999939790652876,.4499967756933969,.5810134930708691,.5000016772202805,.5000000000000019],[.7926527002332949,.7998148343101277,.664461763102612,.23437189100255817,.2999539942514408,.32383595746415084,.3345965581117565,.2515625773781579,.34213326346755835,.3718929526348279,.599857594075161],[.36030504972402344,.3851440273423917,.4416249998926035,.40010601067586826,.15077831480620726,.6391943474631915,.2264197941723451,.2531048687447304,.4802727937284658,.6337255078787051,.5999999966093541],[.300002323908482,.3246789174770642,.45607265798448315,.27466039696432293,.3001691537530712,.749977527302106,.15756830805264585,.180000016338696,.6499993135404775,.6044590213349871,.5999999306882622],[.30000153476691743,.6432750942029539,.6681936890142497,.30101422996821586,.7122183034711418,.7204237661023818,.5994381483142092,.41759972183565347,.6499973269848692,.5943807107864959,.5997593498280507]],[[.010002736130576326,.35699430158258355,.09992059485205083,.3727063430231967,.3253106423675559,.1300044800510849,.5609897380941551,.2523716598724808,.2581317545016043,.3399999926304111,.3412311615096291],[.010000000000510737,.010214573665567104,.010016430124098058,.2998537052156519,.1310350979555563,.4499877216601661,.24977933576006733,.27033379444123173,.33999989741271186,.3000325628281218,.3000000407775681],[.010003584729251145,.10000020289562661,.03836437899961667,.07475395114995903,.24348394872402576,.45121710979564034,.48076690584707094,.3490615998807401,.3012875192265205,.3000000000426848,.7193042655688131],[.18340750970051364,.20360088739747015,.342927157875668,.11450943547929748,.10085701368393032,.49397513865244014,.16089252037188473,.16000011680168155,.30002616810028304,.46239864756776444,.7199999999998844],[.20002447397614942,.3499994798675418,.35000815239958855,.41852958369267657,.04237291332884862,.03000000062654698,.27998322550172017,.3000400906072059,.5996567047701284,.5000000332477735,.51730683090132],[.2012186359648604,.20824192711368014,.41940431740701445,.3801611824270278,.3496883340293187,.050001955361944114,.2989167504849639,.31373077110873365,.5999931763617955,.5000016772202925,.5000000000000019],[.224533479880901,.2610339433893062,.2999893479436254,.2654753825381122,.4084955272643994,.17089031036231567,.2998083875197292,.3500000000000375,.35000046859306844,.5000806815838702,.5000000000000969],[.23950661307024235,.6677661505336259,.58416611847521,.12942293028940421,.3920538649866217,.4782200004989822,.19000491732388836,.34999999983625957,.35,.35,.36999813082657745],[.4355694010134214,.3304174932348595,.6247646969574543,.10061567273649004,.1902528060381799,.16802687829633514,.17061645687437288,.4103285774040764,.367930335448742,.4308166002648265,.41006466889934284],[.3000159026885235,.6024785728735296,.6147794986233526,.2031833933999191,.6384887958596243,.6400112166683943,.15001790988532732,.44785632037799633,.37312730392104193,.37111178951560986,.42588875409588967],[.7013540206520495,.36000188176506137,.36000501697240694,.36087826580886356,.6503827822854108,.640624799137948,.4194552918070105,.3065141052348717,.5578212404568536,.2713968462609888,.46331424383024505]],[[.46177219514088486,.15950038080077608,.0880215347984041,.3754852561121806,.12007265986451006,.4795136486838508,.376000947307091,.3000000180646259,.4149899883673541,.42000000000000004,.41999999999999993],[.34572611349533716,.3499405833853849,.4207217289190851,.3489209199756535,.09880320379990884,.4769811885893704,.3072235964228315,.2999781858876394,.4199999999572027,.42000000000000004,.22267951699932448],[.29644932379374644,.2000452001532942,.7995248497901857,.7844320137467182,.011534829144544867,.4500001835734566,.22382827045114495,.16000038230024718,.2500003900294053,.7199999979357519,.71999876191718],[.20019687875408684,.20000000262118078,.23870338746293684,.037995648535249005,.22432626591937568,.33355427242187125,.1556784857715614,.04002496776466204,.20731597681870143,.7199999999999978,.7199999999999998],[.21610264197799411,.2000040226475747,.23754109022911835,.2015537539303885,.31093926790351084,.15992585400931364,.039999974879668616,.04000000367426071,.19984237536609561,.7199999944138887,.72],[.20081770844352956,.719999999951507,.7199999376368519,.14126233064345725,.04316857268891772,.16048955778077212,.2998921867160009,.041829062389298094,.5991158681204559,.5000846201930655,.7189934820579195],[.21492476521789017,.7199999899996623,.7199999995364854,.10892620819986605,.10273128468060315,.2999751586761783,.29999992849826257,.34995086245671947,.3499999999990069,.3500187814280165,.3700000112466386],[.2387113503445419,.7199606064300546,.5000038282555153,.2999970225447041,.29999902965933334,.1556711157706035,.1939950011261526,.35269733537847703,.350000003119773,.35693039997966963,.37],[.45800172621679297,.5000000000052377,.5000000046774565,.12729134338393733,.16828197895778432,.15188426781099912,.37805270996532603,.3997911101110221,.3500575116492288,.36515454536506303,1.068775667940785],[.795090322408471,.7992655225868087,.4453042121914271,.7855892320376452,.7999402672254181,.40128601670985914,.3200753419410962,.35303994841964476,.346411784200869,.29766483378552344,1.1996934368068426],[.7999999998920276,.7999863481350172,.36000000001885,.7993276467613316,.7999995302373697,.32000228447698637,.3199999998674885,.27189786850411596,.3710058943371592,.2966055146243711,.5647618220308935]],[[.4249999976601699,.4095764184008396,.23251310311404277,.07985649640552467,.2997605002006554,.1693210303141543,.22835823003054412,.33498338114147597,.42000000000000004,.42000000000000004,.41999999999509413],[.42306498500664225,1.0973789220944101,.4630576254458245,.2210124788484886,.2997605001623002,.1762652806367915,.27345705873410536,.16000000241947512,.41999999998616083,.41999999999990284,.12000323367246667],[.30000000057725335,1.0996812163359422,.45936126438197705,.3905671872792876,.03007353012357172,.4039670415547832,.16007312033786392,.16000040844418262,.2500000067511858,.1473984018943533,.12000000013661907],[.2999999788948532,.2200000003879323,.3710286898242071,.35311989502864777,.043525076274974595,.08586336022361185,.04000080011701336,.061080711475513645,.24970668316203776,.7153817959657736,.47139137547103005],[.2203455850251766,.22000000000319628,.22300151332253199,.3000295062858568,.287263425739991,.237690524740794,.04067019952257561,.06939578299986739,.20000002056921803,.22468849637484747,.7199999999316148],[.7199999990878102,.7199999999298201,.5955433420976189,.21026198426147533,.1374190595886518,.16075969059238132,.19904053141955116,.5994354747353007,.5995309816852034,.1933106441200247,.7096276477999964],[.7199998525692596,.719999999353581,.35005213018686765,.21001487881421493,.20966206372422388,.14363148428184794,.15804176637218703,.09000169762663347,.14981223912121372,.3716997855280974,.3714331797718466],[.7198125161536055,.6521388057334421,.4962795137444465,.3544530708400621,.2937381153214428,.14957638976648063,.05006538679987873,.050466162674192065,.4032921913902757,.3699999999972285,.37000000000000005],[.4580000000000306,.4999999998922213,.4999999999997183,.4993486045773438,.17607024110471398,.17032324411014688,.29973862118692624,.3005806313000522,.3500008274929589,.36815687104895567,.37000000003758204],[.4580013566765827,.7679236511986101,.4999077130334472,.4494588381687813,.3496738471545475,.17001315195898598,.4197892835893072,.41999905991496356,.3498589523766883,.5822250713720245,.6440472177179373],[.798141394263992,.7999999992328676,.46825160785028097,.45310639084002197,.2474215575986872,.2400000012082397,.32040063944431485,.529941522862144,.3100246744226781,.5932970135304707,.6279175684279172]],[[.3000476879468072,.05150968855216274,.1450138705770152,.2438451105473105,.15609584780515334,.3109563430356853,.3283681136603056,.28360655200266993,.42000000000000004,.42000000000000004,.4199997632500167],[.44813400535081954,1.0995135305998378,.45422306038196375,.48467491071867136,.09462940614969352,.4499955340892627,.4498887506875018,.15679650014814145,.41999999930140197,.4199999953099801,.12000000006700894],[.30000000000429017,1.0755027930644783,.3528066888813132,.28007019199552596,.27995893809878275,.4499991725044817,.023149948462037745,.08135738838955688,.24999999967363246,.12003608799516657,.12],[.2999999998431466,.22000001921128698,.3411315663579975,.3462917313776634,.29250679923267725,.2989196296880795,.010185365422572912,.24977982701649257,.26514319709397455,.4199962886414955,.12000000000338482],[.24948749754565125,.22000000000904524,.2091037173607029,.2000144188642531,.29964026764185664,.2483060215623529,.060000193261210415,.599651406182163,.1107893070398818,.11032023888683937,.29105299055024986],[.7199998880636999,.59969980622131,.593313431124601,.2697900133860194,.49968766756291966,.11774545048736679,.27852554035505916,.5999997637064661,.41675384353925576,.10135091429868379,.5499692936290149],[.7199882972109523,.3500000268760962,.3500006496777724,.3497217012028263,.4129615136194477,.47108657816626454,.39723309091036463,.24546818514977398,.5499996081524697,.5499999959372983,.549999999973148],[.45800185643199526,.3500000025345016,.350000000002649,.3499999873927921,.8499997696296748,.8492565487599543,.23893088762292805,.36719340291090413,.3001361443175873,.3677340842557637,.3700762520778083],[.458,.4640205261711489,.4145971056412869,.4100000000021648,.8499173954854919,.8484391849602011,.3987541002005378,.7183569926937726,.7153795337884191,.3696568819155844,.3699999999999096],[.4580000000000784,.45800019095014266,.40999999947211896,.4100000000254527,.24930698460598721,.5425555303796437,.13045075288094662,.1929877369213762,.3606164421892479,.3000063701526316,.30071298848695893],[.4580036161993462,.7872188396644729,.30002668959852385,.4077954698809519,.24000000638476743,.2421944629217984,.593900624946396,.2498385233171751,.23998842716983457,.4713592374081364,.45389301523940395]],[[.3,.2999994180436823,.35004727524304435,.3850268158962654,.4965093682226296,.41839419986868637,.6581655754540034,.5257376184261628,.12250355793532625,.4199618988840815,.4017842079427029],[.30000000000000004,.2999991313264234,.4899368089914427,.4999986054898311,.4744075761509977,.22767157148147285,.578715968602152,.6664562870865318,.05121757208528498,.41585882378530564,.12000000000000138],[.3000000000000319,.45300288334200034,.3730344622318538,.29890285377430276,.2828726204678854,.04340862730345205,.010007749927804514,.01005580036835485,.2676682232723322,.4197606584709293,.12000000196433969],[.29999999999883425,.2612533359663302,.4999918633780942,.3201525415517367,.2800000010828307,.26963212828050565,.14464563057326413,.08001674931268732,.419999996837601,.4199999996612196,.5499999987461748],[.28003860419380955,.2800001352241261,.48109714213061844,.4999999073382107,.42928535688158365,.06853442593375011,.05991241889464289,.12159037646037023,.313643076817132,.22387620534514419,.5499999856703539],[.28000000000050873,.2800001637339888,.21755349617825295,.3304978619344474,.400087717887291,.40850502277449463,.050164577486993,.06310182173183856,.5385587896740087,.5418647578551629,.5476970446471834],[.35000000004082404,.34999999244316793,.11450622778983002,.10001127351418516,.21841169972816463,.5872247743123942,.12451482322984879,.15646204845972853,.5499998569680966,.5253078494195895,.5499992422775506],[.4578278338036072,.3499999999997433,.3499159042948417,.10000226685029988,.5477047143120715,.5250612777313948,.13776510668212513,.26950819447717683,.28966902855369053,.3000018700207298,.5497280982028735],[.458,.4579997908466067,.40999992672140273,.3241001419870154,.3239052076006971,.849999449427495,.10237971899877688,.23735486386161064,.8075407179810848,.36645054294165114,.2200001531527085],[.458,.30430351409810436,.30000019840438497,.310003663960911,.3100000000059059,1.1251301208029287,.3000704316179888,.10523054095129487,.18136249187293327,.19508834396644362,.5999785989742596],[.4580000000002089,.30000000003597654,.3,.3000001098812041,.31192860186252325,1.1999662133044244,.598626960829432,.4256167024807708,.18872123041659541,.4128636086451662,.5999934231134317]],[[.3,.30000000000000426,.3500000002413127,.3012425657954595,.13528257139898273,.6694409625601625,.45745531769930253,.4400018321053441,.05884486102891573,.2299999999998588,.2299999999828618],[.3,.30000000000000004,.3607976155829617,.499999831549552,.1012222189064817,.12967333944236553,.3878704307640436,.10646578988047059,.05000003131225581,.2299999990410322,.22999779598340142],[.3,.2999999449393903,.4999816630636416,.4998708016241177,.47532965277360206,.3999998698340824,.3537216041018745,.3599436489452422,.21704650121249988,.21000041156917126,.5499999968073078],[.280000000312668,.280000000019909,.2803440419385459,.4999841008875157,.2806552666869525,.3921303943623641,.29840743585437823,.4325317072165762,.22867869613103528,.24193966877442236,.5499998982060823],[.27999999999999997,.2800000000000078,.28000012028395105,.22027638354513623,.22000017102440989,.08114578320404357,.0803609516598572,.19130384214983906,.4603294340452555,.9306247576064101,.5176103736712991],[.27999999999999997,.2799999999996904,.2688761665331487,.22000010955816407,.2501357948757781,.5977602335331028,.05075522707931016,.19990330334105702,.49405506273232236,.9835555681707044,.10002043304403162],[.28000000000000225,.2799951089104498,.1004366260843041,.24939978583640082,.2608043934560912,.5501003286028597,.19986866975202336,.10016134714957257,.4797426321858934,.30003263158716076,.3000940945393328],[.3927485157073962,.1760908427722633,.10000215754933822,.24991523252725792,.5291645703587751,.2012247712737488,.1999999279105491,.10054015039503741,.489649363004218,.2999956861004867,.2997408628941405],[.49431936203574717,.30000000000283084,.300694509784795,.3099999999999995,.3099999999358249,.1000000626593012,.10000000126700978,.22416232037462158,.39722772109083526,.5051450721983802,.2200000215376351],[.6699999916608385,.3000000000009197,.30000000000227695,.3099998533943244,.3100000000418952,1.1899792018488307,.37334351631419854,.452539460614242,.3776428940495485,.38678638971997437,.5998681469816594],[.6699999999999994,.3000000000009197,.3,.3000020805320341,.3235236127956057,1.199999998099152,.611304404641479,.4230279803863696,.8499938012765449,.11441422233564782,.7576070481831824]],[[.41499999998113524,.41499908963410115,.20000000000000015,.20000000059789255,.2037374952282865,.7999978985537061,.7732754140961666,.4243039133174317,.22999999959645093,.22999999999999984,.224004258882474],[.41499999746168226,.4148776365847126,.20000000000000004,.2000000000318745,.27999874176528483,.28000009301256845,.2772921101535051,.05716236388086104,.22999755058034926,.22999999998286183,.22000005191946087],[.41499965846184694,.3986087507430209,.20139848408468827,.27777148734473894,.22230567489992167,.17601775105568523,.37048216812289503,.3600020586087628,.3313469954666421,.22415387165892858,.22000000000040368],[.27999999999999997,.27999999999999997,.2799999997239113,.22027650201092372,.16000032622099328,.28883045370800786,.15716583459522598,.3620488779791558,.2556172423283527,.26381507074567434,.3901259878547838],[.27999999999999997,.27999999999999386,.2797306981623197,.22000000030174371,.22000001740653302,.19003575942902662,.1167101913174837,.11000004241749013,.5506655893396362,.7163104463663066,.10000591180803421],[.27999999999999997,.2799999943943627,.22001455792522284,.22000234192627732,.2499999381870104,.37480446660957106,.1777717233175978,.16158838022306174,.2986646855628521,.9975319406855849,.10000936126550082],[.27999999999988384,.27527995520872733,.22031186264693184,.24999999953732918,.2499996984278941,.5475523697189598,.20000000002664162,.18700815242439164,.34999967118208386,.13841656799449711,.12000000310364956],[.67,.2375086494606533,.23543554104162326,.10001084304622511,.1000000000843115,.10143557841893029,.1999999985799278,.20853972715456265,.352258868389545,.12105226952621934,.12056575419942919],[.67,.67,.10000147713297158,.10000000000096564,.1,.1000024477044935,.10000006266914464,.4985132204623586,.4796151825619241,.3999177154995981,.5502934417607722],[.67,.67,.30000011834350415,.3099999922585239,.30999994046858054,.1000000560510102,.2983480842017173,.3793643352668903,.32482895464751016,.44106666307495457,.29672680028312926],[.67,.67,.3000001183003829,.3000392548491645,.3979273569433102,1.1999999999962396,.4293343169301787,.34999976092432106,.3580792329460435,.7737355694382616,.7483328510172207]],[[.415,.415,.20000000424959638,.2216197257121956,.29999994416731146,.26422031227146575,.2499999904056047,.060000033475826234,.22462421541349498,.22999988359575355,.22000000000764405],[.415,.415,.2000000002243939,.20143557829179418,.2999988741946122,.29999859845879945,.22918573293915134,.06000000000001374,.09151752807797611,.2240042588824739,.22000000000000008],[.415,.415,.20000000001184895,.22180504210993315,.16251358738355354,.16005084360100447,.1594581652427369,.06011996697532173,.2114740129631973,.22000005191946084,.22000000000000003],[.41486439753110643,.27999999999999986,.27999464155751425,.16000158582618335,.16000000039537104,.160000010745271,.18783004546638737,.17594215081884892,.5003545823194971,.6298615232787442,.6285092354317877],[.27999999999999997,.2799999998889523,.22072615996172967,.22000000000001677,.2190712088079296,.1899861552435547,.18401841168611105,.4996152869508507,.5003545970294114,.6298615232787699,.6299999985763297],[.2799999999999977,.2798986835184462,.22000000080430304,.22004428964539535,.24999987132887638,.23543612711257836,.11000001625614618,.4999985268990348,.5003545970021752,.6298615232786098,.6299999272919468],[.2799999978969669,.22003878849543762,.22414677704374264,.10002889867494213,.10000000022470605,.10000000000000199,.19962220134588596,.3499139224333701,.34994525704012613,.12014868922887813,.12000059260221152],[.67,.6699992144879051,.10000000000000465,.1,.1,.1,.16621339018159798,.34541132529735025,.3489678030294539,.1239952429315256,.5499999925994346],[.67,.67,.1000000013807451,.1,.1,.09999999999999999,.10000315606592249,.5271618158758151,.7525227926234761,.7744193764097509,.5500000000783559],[.67,.67,.67,.10000000000000102,.1,.10000000000001323,.34876931044347786,.34999999956350575,.47775634911942544,.7204542234303687,.4997886657307837],[.67,.67,.67,.3143072543615206,.6995921669020825,.3622073830704024,.35000000000005166,.35,.3500000000000241,.22949081836776214,.995437808223358]]],q=(t,e,n)=>t+n*(e-t),$0=(t,e,n,o)=>{const r=Math.floor(e),a=Math.ceil(e),l=Math.floor(n),h=Math.ceil(n),g=Math.floor(o),d=Math.ceil(o),y=Math.max(0,Math.min(r,t.length-1)),L=Math.max(0,Math.min(a,t.length-1)),i=Math.max(0,Math.min(l,t[0].length-1)),p=Math.max(0,Math.min(h,t[0].length-1)),S=Math.max(0,Math.min(g,t[0][0].length-1)),E=Math.max(0,Math.min(d,t[0][0].length-1)),x=t[y][i][S],v=t[y][i][E],P=t[y][p][S],D=t[y][p][E],s0=t[L][i][S],k=t[L][i][E],Y=t[L][p][S],V=t[L][p][E],U=e-r,j=q(x,s0,U),W=q(v,k,U),Z=q(P,Y,U),K=q(D,V,U),m=n-l,c=q(j,Z,m),u=q(W,K,m),f=o-g;return q(c,u,f)};function q0(t,e,n){const o=t*(r0.length-1),r=e*(r0[0].length-1),a=n*(r0[0][0].length-1),l=$0(r0,o,r,a),h=Math.max(.1,Math.min(l,1));return Math.round(h*100)/100}function i0(){const t=document.getElementById("draggable-list");if(!t)return console.error("Draggable list element not found."),[];const e=t.querySelectorAll(".draggable-item"),n=[];return e.forEach(o=>{const r=o.querySelector("input[readonly]"),a=o.querySelector('input[type="color"]'),l=o.querySelector(".filament-layer-opacity"),h=o.querySelector(".layer-height-number");if(r&&a&&l&&h){const g=parseFloat(l.value),d=parseFloat(h.value);!isNaN(g)&&!isNaN(d)&&n.push({name:r.value,color:a.value,opacity:g,layerHeight:d})}}),n}let N0=0;function D0(t){var k,Y,V,U,j,W,Z,K;const e=document.getElementById("draggable-list"),n=document.getElementById("add-item-button-new"),o=document.getElementById("add-item-button-existing"),r=document.getElementById("existing-filament-list"),a=document.getElementById("existing-filament-selection"),l=document.getElementById("layer-height-input"),h="draggable-item",g="drag-handle";let d=null;if(!e||!n||!o||!r||!a){console.error("Required elements not found.");return}const y=m=>{m.setAttribute("draggable","true"),m.addEventListener("dragstart",c=>{var f;(f=c.dataTransfer)==null||f.setDragImage(document.createElement("image"),0,0);const u=c.target;u.classList.contains(g)&&(d=u.parentElement,d?d.classList.add("dragging"):c.preventDefault())})};e.querySelectorAll(`.${g}`).forEach(y),e.addEventListener("dragend",m=>{d&&(d.classList.remove("dragging"),d=null),t(e)}),e.addEventListener("dragover",m=>{if(m.preventDefault(),d){const c=G0(e,m.clientY,h);c==null?e.appendChild(d):e.insertBefore(d,c)}});const L=(m,c)=>{e.querySelectorAll(`.${h}[data-id="${m}"]`).forEach(b=>{const I=b.querySelector("input[readonly]");I&&(I.value=c)});const f=a.querySelector(`option[data-id="${m}"]`);f&&(f.textContent=c,f.value=c)},i=(m,c,u)=>{e.querySelectorAll(`.${h}`).forEach(b=>{const I=b.querySelector("input[readonly]");if(I&&I.value===m){const w=b.querySelector('input[type="color"]'),R=b.querySelector(".filament-layer-opacity");w&&(w.value=c),R&&(R.value=u)}})},p=(m,c)=>{const u=m.querySelector(".layer-height-slider"),f=m.querySelector(".layer-height-number");u&&f&&(u.value=c.toString(),f.value=c.toString())},S=(m,c)=>Math.round(m/c)*c,E=m=>{const c=m.target,u=c.closest(`.${h}`),f=parseFloat(l.value);if(u&&!isNaN(f)){let b=parseFloat(c.value);c.classList.contains("layer-height-number")&&(b=S(b,f));const I=parseFloat(c.min)||0,w=parseFloat(c.max)||1/0;b=Math.max(I,Math.min(b,w)),p(u,b),t(e)}};e.querySelectorAll(`.${h}`).forEach(m=>{var c,u;(c=m.querySelector(".layer-height-slider"))==null||c.addEventListener("input",E),(u=m.querySelector(".layer-height-number"))==null||u.addEventListener("change",E)}),r.addEventListener("change",m=>{const c=m.target,u=c.closest(".filament-list-item");if(u){const f=u.dataset.id,b=u.querySelector("span"),I=u.querySelector('input[type="text"]'),w=u.querySelectorAll('input[type="color"]')[0],R=u.querySelectorAll('input[type="text"]')[1],F=u.querySelectorAll('input[type="number"]')[0],A=u.querySelector(".delete-filament-button");if(f&&b&&I&&w&&R&&F)if(c===I)L(f,I.value),b.textContent=I.value;else{let C;c===w?(C=w.value,R.value=C):c===R?(C=R.value,w.value=C):C=w.value,i(b.textContent||"",C,F.value)}c===A&&f&&P(f)}});const x=(m,c)=>{const u=m.value;if(u){const f=parseInt(u.substring(1,3),16)/255,b=parseInt(u.substring(3,5),16)/255,I=parseInt(u.substring(5,7),16)/255;c.value=q0(f,b,I).toFixed(2)}};{const m=(Y=(k=document.querySelector("#add-item-button-new"))==null?void 0:k.parentElement)==null?void 0:Y.querySelector('input[type="text"]'),c=(U=(V=document.querySelector("#add-item-button-new"))==null?void 0:V.parentElement)==null?void 0:U.querySelector('input[type="color"]'),u=(W=(j=document.querySelector("#add-item-button-new"))==null?void 0:j.parentElement)==null?void 0:W.querySelector('input[type="text"][placeholder="Hex Code"]'),f=(K=(Z=document.querySelector("#add-item-button-new"))==null?void 0:Z.parentElement)==null?void 0:K.querySelectorAll('input[type="number"]')[0];m&&c&&u&&f&&(m.value=`Filament ${r.querySelectorAll(".filament-list-item").length+1}`,c.value="#000000",u.value="#000000",f.value="0.10",c.addEventListener("input",()=>{u.value=c.value,x(c,f)}),u.addEventListener("input",()=>{c.value=u.value,x(c,f)}))}n.addEventListener("click",()=>{var b,I,w,R,F,A,C,J,Q,T,e0;const m=(I=(b=document.querySelector("#add-item-button-new"))==null?void 0:b.parentElement)==null?void 0:I.querySelector('input[type="text"]'),c=(R=(w=document.querySelector("#add-item-button-new"))==null?void 0:w.parentElement)==null?void 0:R.querySelector('input[type="color"]'),u=(A=(F=document.querySelector("#add-item-button-new"))==null?void 0:F.parentElement)==null?void 0:A.querySelector('input[type="text"][placeholder="Hex Code"]'),f=(J=(C=document.querySelector("#add-item-button-new"))==null?void 0:C.parentElement)==null?void 0:J.querySelectorAll('input[type="number"]')[0];if(m&&c&&u&&f){const _=m.value,$=c.value,c0=`filament-${N0++}`,h0=parseFloat(l.value)||.08;if(!$){alert("Please select a color for the new filament.");return}const B=document.createElement("li");B.classList.add(h),B.dataset.id=c0,B.innerHTML=`
                <div class="${g}">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 9H21V11H3V9ZM3 15H21V17H3V15Z" fill="currentColor"/>
                    </svg>
                </div>
                <div class="row">
                    <span>Name: <input type="text" value="${_}" readonly/></span>
                </div>
                <div class="row">
                    Colour: <div class="h-gap-small"></div> <input type="color" value="${$}" disabled/>
                    <div class="h-gap"></div>
                    Opacity: <div class="h-gap-small"></div> <input type="number" step="0.01" min="0" max="5" value="${f.value}" class="filament-layer-opacity" readonly/>
                </div>
                <div class="row">
                    Layer Height:
                    <div class="h-gap-small"></div>
                    <input type="range" min="0.00" max="2" step="${l.value}" value="${h0}" class="layer-height-slider">
                    <div class="h-gap"></div>
                    <input type="number" min="0.00" max="2" step="0.01" value="${h0}" class="layer-height-number">
                    <div class="h-gap-small"></div> mm
                </div>
                <button class="delete-layer-button">Delete</button>
            `,e.appendChild(B),y(B.querySelector(`.${g}`)),(Q=B.querySelector(".layer-height-slider"))==null||Q.addEventListener("input",E),(T=B.querySelector(".layer-height-number"))==null||T.addEventListener("change",E),(e0=B.querySelector(".delete-layer-button"))==null||e0.addEventListener("click",T0=>{var v0;const f0=(v0=T0.target)==null?void 0:v0.closest(`.${h}`);f0&&v(f0)}),D();const t0=document.createElement("li");t0.classList.add("filament-list-item"),t0.dataset.id=c0,t0.innerHTML=`
                <span>${_}</span>
                <div class="row">
                    <span>Name: <input type="text" value="${_}"/></span>
                </div>
                <div class="row">
                    <span>Color: <input type="color" value="${$}"/> <input type="text" placeholder="Hex Code" value="${$}"/></span>
                </div>
                <div class="row">
                    <span>Opacity: <input type="number" step="0.01" min="0" max="1" value="${f.value}"/> mm</span>
                </div>
            `,r.appendChild(t0);const n0=document.createElement("option");n0.value=_,n0.textContent=_,n0.dataset.id=c0,a.appendChild(n0),m.value=`Filament ${r.querySelectorAll(".filament-list-item").length+1}`,c.value="#000000",u.value="#000000",f.value="0.10",c.addEventListener("input",()=>{u.value=c.value,x(c,f)}),u.addEventListener("input",()=>{c.value=u.value,x(c,f)}),t(e)}}),o.addEventListener("click",()=>{var f,b,I;const m=a.options[a.selectedIndex],c=m.dataset.id,u=m.value;if(c&&u!=="None"){const w=Array.from(r.querySelectorAll(`.filament-list-item[data-id="${c}"]`))[0],R=parseFloat(l.value)||.08;if(w){const F=w.querySelector('input[type="text"]'),A=w.querySelectorAll('input[type="color"]')[0],C=w.querySelectorAll('input[type="number"]')[0];if(F&&A&&C){const J=A.value,Q=C.value,T=document.createElement("li");T.classList.add(h),T.dataset.id=c,T.innerHTML=`
                    <div class="${g}">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 9H21V11H3V9ZM3 15H21V17H3V15Z" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="row">
                        <span>Name: <input type="text" value="${u}" readonly/></span>
                    </div>
                    <div class="row">
                        Colour: <div class="h-gap-small"></div> <input type="color" value="${J}" disabled/>
                        <div class="h-gap"></div>
                        Opacity: <div class="h-gap-small"></div> <input type="number" step="0.01" min="0" max="5" value="${Q}" class="filament-layer-opacity" readonly/>
                    </div>
                    <div class="row">
                        Layer Height:
                        <div class="h-gap-small"></div>
                        <input type="range" min="0.00" max="2" step="${l.value}" value="${R}" class="layer-height-slider">
                        <div class="h-gap"></div>
                        <input type="number" min="0.00" max="2" step="0.01" value="${R}" class="layer-height-number">
                        <div class="h-gap-small"></div> mm
                    </div>
                    <button class="delete-layer-button">Delete</button>
                `,e.appendChild(T),y(T.querySelector(`.${g}`)),(f=T.querySelector(".layer-height-slider"))==null||f.addEventListener("input",E),(b=T.querySelector(".layer-height-number"))==null||b.addEventListener("change",E),(I=T.querySelector(".delete-layer-button"))==null||I.addEventListener("click",e0=>{var $;const _=($=e0.target)==null?void 0:$.closest(`.${h}`);_&&v(_)}),D(),t(e)}}}});const v=m=>{e.removeChild(m),t(e)},P=m=>{e.querySelectorAll(`.${h}[data-id="${m}"]`).forEach(f=>{e.removeChild(f)});const c=r.querySelector(`.filament-list-item[data-id="${m}"]`);c&&r.removeChild(c);const u=a.querySelector(`option[data-id="${m}"]`);u&&a.removeChild(u),t(e)};r.addEventListener("change",m=>{const c=m.target,u=c.closest(".filament-list-item");if(u){const f=u.dataset.id,b=u.querySelector("span"),I=u.querySelector('input[type="text"]'),w=u.querySelectorAll('input[type="color"]')[0],R=u.querySelectorAll('input[type="text"]')[1],F=u.querySelectorAll('input[type="number"]')[0],A=u.querySelector(".delete-filament-button");if(f&&b&&I&&w&&R&&F)if(c===I)L(f,I.value),b.textContent=I.value;else{let C;c===w?(C=w.value,R.value=C):c===R?(C=R.value,w.value=C):C=w.value,i(b.textContent||"",C,F.value)}c===A&&f&&P(f)}});const D=()=>{const m=parseFloat(l.value);isNaN(m)||e.querySelectorAll(".layer-height-slider").forEach(c=>{c.step=m.toString()})},s0=()=>{D()};l.addEventListener("input",s0),D()}function G0(t,e,n){const o=[...t.querySelectorAll(`.${n}:not(.dragging)`)];return Array.from(o).reduce((r,a)=>{const l=a.getBoundingClientRect(),h=e-l.top-l.height/2;return h<0&&h>r.offset?{offset:h,element:a}:r},{offset:Number.NEGATIVE_INFINITY,element:null}).element}class y0{constructor(e,n){let o=s.compute.gl;const r=o.createShader(e);if(!r)throw new Error("Shader creation error");if(this.shader=r,o.shaderSource(this.shader,n),o.compileShader(this.shader),!o.getShaderParameter(this.shader,o.COMPILE_STATUS)){const a=o.getShaderInfoLog(this.shader);throw o.deleteShader(this.shader),new Error(`Shader compilation error: ${a}`)}}dispose(){this.shader&&s.compute.gl.deleteShader(this.shader)}}class X0{constructor(e,n){let o=s.compute.gl;const r=o.createProgram();if(!r)throw new Error("Cannot create gl program");let a=e.shader,l=n.shader;if(o.attachShader(r,a),o.attachShader(r,l),o.linkProgram(r),!o.getProgramParameter(r,o.LINK_STATUS))throw o.deleteProgram(r),new Error("Program linking error: "+o.getProgramInfoLog(r));this.program=r}dispose(){this.program&&s.compute.gl.deleteProgram(this.program)}}class z0{constructor(e,n){this.vertexShader=new y0(s.compute.gl.VERTEX_SHADER,e),this.fragmentShader=new y0(s.compute.gl.FRAGMENT_SHADER,n),this.program=new X0(this.vertexShader,this.fragmentShader)}dispose(){this.vertexShader.dispose(),this.fragmentShader.dispose(),this.program.dispose()}}function u0(t){return`#version 300 es
precision highp float;

// Default maximum of 40 colour changes
// Can probably be increased slightly depending on WebGL hardware limitations
uniform vec3 colours[40];
uniform float heights[40];
uniform float opacities[40];
uniform vec3 heightRange;
uniform int numIndices;

uniform sampler2D inputTexture;
uniform vec2 resolution;

in vec2 v_texCoord;
out vec4 fragColor;

float normalizedExponential(float x) {
    float exp_neg_2x = exp(-2.0 * x);
    float exp_neg_2 = exp(-2.0);  // Precompute e^{-2}
    return (exp_neg_2x - exp_neg_2) / (1.0 - exp_neg_2);
}

vec3 interpolateColours(vec3 colourA, vec3 colourB, float t, float opaqueness) {

    float amountInterpolated = t / opaqueness;
    if (amountInterpolated > 1.) {
        amountInterpolated = 1.;
    }
    
    // amountInterpolated in [0, 1]
    // transform to exponential curve
    float transmission = normalizedExponential(amountInterpolated);
    
    return mix(colourB, colourA, transmission);
}

vec3 srgbToLinear(vec3 srgb) {
    vec3 b = step(vec3(0.04045), srgb);
    vec3 linearLow  = srgb / 12.92;
    vec3 linearHigh = pow((srgb + 0.055) / 1.055, vec3(2.4));
    return mix(linearLow, linearHigh, b);
}

vec3 linearToXyz(vec3 linearRGB) {
    const mat3 rgb2xyz = mat3(
        0.4124564, 0.3575761, 0.1804375,
        0.2126729, 0.7151522, 0.0721750,
        0.0193339, 0.1191920, 0.9503041
    );
    return rgb2xyz * linearRGB;
}

vec3 xyzToLab(vec3 xyz) {
    // Reference white (D65)
    const vec3 white = vec3(0.95047, 1.0, 1.08883);
    vec3 ratio = xyz / white;

    vec3 v;
    for (int i = 0; i < 3; ++i) {
        if (ratio[i] > 0.008856)
            v[i] = pow(ratio[i], 1.0/3.0);
        else
            v[i] = (7.787 * ratio[i]) + (16.0 / 116.0);
    }

    float L = (116.0 * v.y) - 16.0;
    float a = 500.0 * (v.x - v.y);
    float b = 200.0 * (v.y - v.z);

    return vec3(L, a, b);
}

vec3 srgbToLab(vec3 srgb) {
    vec3 linearRGB = srgbToLinear(srgb);
    vec3 xyz = linearToXyz(linearRGB);
    return xyzToLab(xyz);
}

float getHeight(vec3 colour) {
    ${t}
    return height;
}

vec4 compute(vec2 uv) {
    vec4 inputColourRGBA = texture(inputTexture, uv);

    vec3 sourceColour = inputColourRGBA.rgb;
    
    if (inputColourRGBA[3] == 0.) {
        return vec4(0, 0, 0, 0);
    }
    
    float colourHeight = getHeight(sourceColour);
    
    vec3 currentColour = colours[0];
    vec3 previousColour = colours[0];
    float previousHeight = heightRange[0];
    float currentHeight = heightRange[0];
    int index = 0;
    
    for (int i = 0; i < 2000; i++) {
        currentHeight += heightRange[2];

        if (currentHeight > colourHeight + 0.000001) {
            break;
        }
        
        if (currentHeight < heights[0] - 0.000001) {
            continue;
        }

        if (currentHeight < heights[index] - 0.000001) {
            if (index == 0) {
                continue;
            }
        } else {
            index++;
            previousColour = currentColour;
            previousHeight = currentHeight;
            
            if (index >= numIndices) {
                break;
            }
        }
        
        currentColour = interpolateColours(previousColour, colours[index], currentHeight - previousHeight, opacities[index]);
    }

    
    return vec4(currentColour, colourHeight);
}

void main() {
    vec4 resultColor = compute(v_texCoord);
    fragColor = vec4(resultColor);
}
`}const O0=`
    float height = max(colour.r, max(colour.g, colour.b));
    height *= heightRange[1];
`,P0=`
    float height = 0.299 * colour.r + 0.587 * colour.g + 0.114 * colour.b;
    height *= heightRange[1];
`,k0=`
    vec3 currentColour = colours[0];
    vec3 previousColour = colours[0];
    float previousHeight = heightRange[0];
    float currentHeight = heightRange[0];
    int index = 0;
    
    float nearestHeight = 0.;
    float nearestColourDistance = 100000.0;
    
    // Convert to CIE LAB colour space
    vec3 colourLab = srgbToLab(colour);
    
    for (int i = 0; i < 2000; i++) {
        currentHeight += heightRange[2];
        if (currentHeight < heights[0] - 0.000001) {
            vec3 currentColourLab = srgbToLab(currentColour);
            if (distance(currentColourLab, colourLab) <= nearestColourDistance) {
                nearestHeight = currentHeight;
                nearestColourDistance = distance(currentColourLab, colourLab);
            }
            continue;
        }
        
        if (currentHeight > heightRange[1]) {
            break;
        }

        if (currentHeight < heights[index] - 0.000001) {
            if (index == 0) {
                continue;
            }
        } else {
            index++;
            previousColour = currentColour;
            previousHeight = currentHeight;
            
            if (index >= numIndices) {
                break;
            }
        }
        
        currentColour = interpolateColours(previousColour, colours[index], currentHeight - previousHeight, opacities[index]);
        vec3 currentColourLab = srgbToLab(currentColour);
        if (distance(currentColourLab, colourLab) <= nearestColourDistance) {
            nearestHeight = currentHeight;
            nearestColourDistance = distance(currentColourLab, colourLab);
        }
    }
    
    float height = nearestHeight;
`,d0=`#version 300 es
in vec2 a_position;
out vec2 v_texCoord;

void main() {
  gl_Position = vec4(a_position, 0.0, 1.0);
  v_texCoord = (a_position + 1.0) * 0.5;
}
`;class Y0 extends z0{constructor(e){e==H.NEAREST?super(d0,u0(k0)):e==H.GREYSCALE_MAX?super(d0,u0(O0)):super(d0,u0(P0))}uploadComputeData(e,n,o,r,a){let l=s.compute.gl,h=this.program.program;const g=l.getAttribLocation(h,"a_position"),d=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,d);const y=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1];l.bufferData(l.ARRAY_BUFFER,new Float32Array(y),l.STATIC_DRAW),l.enableVertexAttribArray(g),l.vertexAttribPointer(g,2,l.FLOAT,!1,0,0),this.setUniform3fv("colours",e),this.setUniform1fv("heights",n),this.setUniform1fv("opacities",o),this.setUniform3f("heightRange",r[0],r[1],r[2]),this.setUniform1i("numIndices",n.length);const L=l.getUniformLocation(h,"inputTexture");l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,a.texture),l.uniform1i(L,0)}compute(e){let n=s.compute.gl,o=this.program.program;n.useProgram(o);const r=e.width,a=e.height,l=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,l);const h=n.createTexture();if(n.bindTexture(n.TEXTURE_2D,h),n.texImage2D(n.TEXTURE_2D,0,n.RGBA32F,r,a,0,n.RGBA,n.FLOAT,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,h,0),n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete.");let g=s.paint.filaments;const d=[],y=[],L=[];let i=[];for(let S=0;S<g.length;S++){let E=g[S];d.push(E.colour[0]),d.push(E.colour[1]),d.push(E.colour[2]),y.push(E.endHeight),L.push(E.opacity)}if(i=[s.paint.startHeight,s.paint.endHeight,s.paint.increment],y.length==0)return new Float32Array;this.uploadComputeData(d,y,L,i,e),n.viewport(0,0,r,a),n.drawArrays(n.TRIANGLES,0,6);const p=new Float32Array(r*a*4);return n.readPixels(0,0,r,a,n.RGBA,n.FLOAT,p),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindTexture(n.TEXTURE_2D,null),n.deleteFramebuffer(l),n.deleteTexture(h),p}setUniform1i(e,n){const o=s.compute.gl.getUniformLocation(this.program.program,e);o!==null?s.compute.gl.uniform1i(o,n):console.log(`Uniform '${e}' not found, skipping.`)}setUniform3f(e,n,o,r){const a=s.compute.gl.getUniformLocation(this.program.program,e);a!==null?s.compute.gl.uniform3f(a,n,o,r):console.log(`Uniform '${e}' not found, skipping.`)}setUniform1fv(e,n){const o=s.compute.gl.getUniformLocation(this.program.program,e);o!==null?s.compute.gl.uniform1fv(o,n):console.log(`Uniform '${e}' not found, skipping.`)}setUniform2fv(e,n){const o=s.compute.gl.getUniformLocation(this.program.program,e);o!==null?s.compute.gl.uniform2fv(o,n):console.log(`Uniform '${e}' not found, skipping.`)}setUniform3fv(e,n){const o=s.compute.gl.getUniformLocation(this.program.program,e);o!==null?s.compute.gl.uniform3fv(o,n):console.log(`Uniform '${e}' not found, skipping.`)}setUniform4fv(e,n){const o=s.compute.gl.getUniformLocation(this.program.program,e);o!==null?s.compute.gl.uniform4fv(o,n):console.log(`Uniform '${e}' not found, skipping.`)}}const G={};function V0(t){if(t in G){if(G[t]==null)throw new Error("Shader initialisation error");return G[t]}return G[t]=new Y0(t),G[t]}class j0{constructor(e){if(this.imageElement=e,this._width=e.width,this._height=e.height,!s.compute.gl||!this.imageElement)throw new Error("No WebGL instance to create texture");this.texture=s.compute.gl.createTexture(),s.compute.gl.bindTexture(s.compute.gl.TEXTURE_2D,this.texture),s.compute.gl.texImage2D(s.compute.gl.TEXTURE_2D,0,s.compute.gl.RGBA,s.compute.gl.RGBA,s.compute.gl.UNSIGNED_BYTE,this.imageElement),s.compute.gl.texParameteri(s.compute.gl.TEXTURE_2D,s.compute.gl.TEXTURE_MIN_FILTER,s.compute.gl.NEAREST),s.compute.gl.texParameteri(s.compute.gl.TEXTURE_2D,s.compute.gl.TEXTURE_MAG_FILTER,s.compute.gl.NEAREST),s.compute.gl.bindTexture(s.compute.gl.TEXTURE_2D,null)}get width(){return this._width}get height(){return this._height}dispose(){this.texture&&s.compute.gl.deleteTexture(this.texture),this.imageElement=null,this._width=0,this._height=0}}function W0(t,e,n){const o=document.getElementById("canvas-preview");if(o==null||!(o instanceof HTMLCanvasElement))throw new Error("Can't find preview canvas");o.width=e,o.height=n;const r=o.getContext("2d");if(!r)throw new Error("Canvas 2D context not available.");const a=r.createImageData(e,n);return a.data.set(t.map((h,g)=>g%4===3?255:h*255)),r.putImageData(a,0,0),o}function Z0(t,e,n){t&&W0(t,e,n)}function K0(t){const e=document.getElementById("canvas-source");if(!e){console.error('Canvas element with ID "canvas-source" not found.');return}const n=e.getContext("2d");if(!n){console.error("Could not get 2D rendering context.");return}e.width=t.width,e.height=t.height,n.drawImage(t,0,0)}class J0{constructor(e,n,o,r,a="normalised"){if(this.colour=o0(0,0,0),this.endHeight=0,this.opacity=0,this.name="",this.endHeight=n,this.name=o,this.opacity=r,Array.isArray(e)){let l=e[0],h=e[1],g=e[2];(a||"normalised")==="byte"?this.colour=o0(l/255,h/255,g/255):this.colour=o0(l,h,g)}else if(typeof e=="string")this.colour=this.hexToRgbNormalized(e);else throw new Error("Invalid color format provided. Use RGB array or hex string.")}hexToRgbNormalized(e){const n=parseInt(e.slice(1),16),o=n>>16&255,r=n>>8&255,a=n&255;return o0(o/255,r/255,a/255)}}function Q0(){const e=document.getElementById("height-option-selection").value;let n;switch(e){case"nearest":n=H.NEAREST;break;case"greyscale-max":n=H.GREYSCALE_MAX;break;case"greyscale-luminance":n=H.GREYSCALE_LUMINANCE;break;default:throw new Error("Invalid option")}return n}const p0=document.getElementById("detail-size"),I0=document.getElementById("image-resolution-x"),w0=document.getElementById("image-resolution-y"),N=document.getElementById("physical-x"),M=document.getElementById("physical-y"),S0=document.getElementById("file-size-estimate");function a0(t){const e=s.paint.sourceImage.width/s.paint.sourceImage.height;if(t===N){const a=parseFloat(N.value)/e;M.value=isNaN(a)?"":a.toString()}else if(t===M){const a=parseFloat(M.value)*e;N.value=isNaN(a)?"":a.toString()}const n=parseFloat(p0.value);if(isNaN(n)||n<=0){console.error("Invalid detail size.");return}const o=Math.round(parseFloat(N.value)/n),r=Math.round(parseFloat(M.value)/n);I0.value=Math.round(o).toString(),w0.value=Math.round(r).toString(),S0.innerHTML=`Estimated file size: ${o*r*200/1e6} MB`,O()}N.addEventListener("input",()=>a0(N));M.addEventListener("input",()=>a0(M));p0.addEventListener("input",()=>a0(M));function e9(t){if(!s.paint.sourceImage){console.error("Source image is not loaded.");return}const e=parseFloat(p0.value);if(isNaN(e)||e<=0){console.error("Invalid detail size.");return}const n=Math.round(parseFloat(N.value)/e),o=Math.round(parseFloat(M.value)/e);S0.innerHTML=`Estimated file size: ${n*o*200/1e6} MB`;const r=document.getElementById("canvas-source");r.width=n,r.height=o;const a=r.getContext("2d");if(a){a.drawImage(s.paint.sourceImage,0,0,n,o);const l=new Image;l.onload=()=>{s.paint.image=l,I0.value=Math.round(n).toString(),w0.value=Math.round(o).toString(),t()},l.src=r.toDataURL()}else console.error("Could not get 2D rendering context for canvas.")}const E0=document.getElementById("base-layer-height-input"),t9=document.getElementById("layer-height-input");let X;function l0(){if(s.paint.image.height==0){console.log("no image");return}e9(()=>{let t=s.paint.image,e=Q0(),n=V0(e);X!==void 0&&(X.dispose(),X=void 0),X=new j0(t);let o=i0().reverse(),r=parseFloat(E0.value);s.paint.filaments=[];for(let l=0;l<o.length;l++)s.paint.filaments.push(new J0(o[l].color,o[l].layerHeight+r,o[l].name,o[l].opacity)),r+=o[l].layerHeight;s.paint.startHeight=parseFloat(E0.value),s.paint.endHeight=r,s.paint.increment=parseFloat(t9.value);let a=n.compute(X);Z0(a,t.width,t.height),K0(t),s.paint.computedResult=a})}function O(){document.getElementById("auto-update-checkbox").checked&&l0()}document.getElementById("update-painting-button").addEventListener("click",l0);function n9(){const t=document.getElementById("height-option-selection");t&&t.addEventListener("change",e=>{switch(e.target.value){case"nearest":s.paint.heightFunction=H.NEAREST,O();break;case"greyscale-luminance":s.paint.heightFunction=H.GREYSCALE_LUMINANCE,O();break;case"greyscale-max":s.paint.heightFunction=H.GREYSCALE_MAX,O();break;default:console.error("Unknown selection")}})}const z=document.querySelector(".preview-window"),m0=document.querySelector(".resize-handle");function o9(){if(z&&m0){let t=function(a){if(!n)return;let l=r+(a.clientX-o);l<=200&&(l=200),z.style.width=`calc(${l}px - 4rem)`,m0.style.right="0px"},e=function(){n=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",e)},n=!1,o,r;m0.addEventListener("mousedown",a=>{n=!0,o=a.clientX,r=z.offsetWidth,document.addEventListener("mousemove",t),document.addEventListener("mouseup",e),a.preventDefault()}),z.style.width="30vw",window.addEventListener("resize",()=>{z.style.width="30vw"})}}function r9(){const t=document.createElement("canvas"),e=t.getContext("webgl2")||t.getContext("experimental-webgl");if(!e||!(e instanceof WebGL2RenderingContext))throw console.error("Unable to initialize WebGL. Your browser may not support it."),new Error("Cannot initialise WebGL.");if(s.compute.gl=e,s.compute.canvas=t,!e.getExtension("EXT_color_buffer_float"))throw new Error("Required extensions not supported")}function i9(t,e,n){const o=[];for(let r=0;r<n;r++){o[r]=[];for(let a=0;a<e;a++){const l=(r*e+a)*4;o[r][a]=t[l+3]}}return o}function a9(t,e="filament-painting.stl",n=1){const o=t.length,r=t[0].length,a=(i,p,S,E,x,v)=>(x.setFloat32(v,E[0],!0),v+=4,x.setFloat32(v,E[1],!0),v+=4,x.setFloat32(v,E[2],!0),v+=4,x.setFloat32(v,i[0]*n,!0),v+=4,x.setFloat32(v,-i[1]*n,!0),v+=4,x.setFloat32(v,i[2],!0),v+=4,x.setFloat32(v,p[0]*n,!0),v+=4,x.setFloat32(v,-p[1]*n,!0),v+=4,x.setFloat32(v,p[2],!0),v+=4,x.setFloat32(v,S[0]*n,!0),v+=4,x.setFloat32(v,-S[1]*n,!0),v+=4,x.setFloat32(v,S[2],!0),v+=4,x.setUint16(v,0,!0),v+=2,v);let l=0;l+=(o-1)*(r-1)*2;for(let i=0;i<o-1;i++)for(let p=0;p<r-1;p++){const S=t[i][p],E=t[i][p+1],x=t[i+1][p+1],v=t[i+1][p];(S!==0||E!==0||x!==0||v!==0)&&(l+=2)}for(let i=0;i<o-1;i++)(t[i][0]!==0||t[i+1][0]!==0)&&(l+=2),(t[i][r-1]!==0||t[i+1][r-1]!==0)&&(l+=2);for(let i=0;i<r-1;i++)(t[0][i]!==0||t[0][i+1]!==0)&&(l+=2),(t[o-1][i]!==0||t[o-1][i+1]!==0)&&(l+=2);const h=new ArrayBuffer(84+l*50),g=new DataView(h);for(let i=0;i<80;i++)g.setUint8(i,0);g.setUint32(80,l,!0);let d=84;for(let i=0;i<o-1;i++)for(let p=0;p<r-1;p++){const S=t[i][p],E=t[i][p+1],x=t[i+1][p+1],v=t[i+1][p];d=a([p,i,S],[p+1,i,E],[p+1,i+1,x],[0,0,1],g,d),d=a([p,i,S],[p+1,i+1,x],[p,i+1,v],[0,0,1],g,d)}for(let i=0;i<o-1;i++)for(let p=0;p<r-1;p++){const S=t[i][p],E=t[i][p+1],x=t[i+1][p+1],v=t[i+1][p];(S!==0||E!==0||x!==0||v!==0)&&(d=a([p,i,0],[p+1,i,0],[p+1,i+1,0],[0,0,-1],g,d),d=a([p,i,0],[p+1,i+1,0],[p,i+1,0],[0,0,-1],g,d))}for(let i=0;i<o-1;i++)(t[i][0]!==0||t[i+1][0]!==0)&&(d=a([0,i,t[i][0]],[0,i+1,t[i+1][0]],[0,i+1,0],[0,0,0],g,d),d=a([0,i,t[i][0]],[0,i+1,0],[0,i,0],[0,0,0],g,d)),(t[i][r-1]!==0||t[i+1][r-1]!==0)&&(d=a([r-1,i,t[i][r-1]],[r-1,i+1,t[i+1][r-1]],[r-1,i+1,0],[0,0,0],g,d),d=a([r-1,i,t[i][r-1]],[r-1,i+1,0],[r-1,i,0],[0,0,0],g,d));for(let i=0;i<r-1;i++)(t[0][i]!==0||t[0][i+1]!==0)&&(d=a([i,0,t[0][i]],[i+1,0,t[0][i+1]],[i+1,0,0],[0,0,0],g,d),d=a([i,0,t[0][i]],[i+1,0,0],[i,0,0],[0,0,0],g,d)),(t[o-1][i]!==0||t[o-1][i+1]!==0)&&(d=a([i,o-1,t[o-1][i]],[i+1,o-1,t[o-1][i+1]],[i+1,o-1,0],[0,0,0],g,d),d=a([i,o-1,t[o-1][i]],[i+1,o-1,0],[i,o-1,0],[0,0,0],g,d));const y=new Blob([h],{type:"application/octet-stream"}),L=document.createElement("a");L.href=URL.createObjectURL(y),L.download=e,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(L.href),console.log("Binary STL generation and download initiated.")}const l9=document.getElementById("export-stl"),s9=document.getElementById("detail-size"),c9=document.getElementById("image-resolution-x");document.getElementById("image-resolution-y");document.getElementById("physical-x");document.getElementById("physical-y");const u9=document.getElementById("instructions"),d9=document.getElementById("base-layer-height-input"),x0=document.getElementById("layer-height-input");function m9(t){const e=[],n=new Set;for(const o of t){const r=`${o.colour[0]}-${o.colour[1]}-${o.colour[2]}-${o.name}-${o.opacity}`;n.has(r)||(e.push(o),n.add(r))}return e}function g9(){l9.addEventListener("click",t=>{if(l0(),s.paint.image.width==0){console.log("No image");return}let e=i9(s.paint.computedResult,s.paint.image.width,s.paint.image.height),n=parseFloat(c9.value);if(n<2)return;let o=n/(n-1),r=parseFloat(s9.value),a=o*r;a9(e,"filamentPainting.stl",a);let l=m9(s.paint.filaments),h="";for(let y of l)h+=`${y.name} - Opacity ${y.opacity} mm
`;let g="";for(let y=0;y<s.paint.filaments.length;y++){let L=s.paint.filaments[y];y==0?g+=`- Begin with ${L.name} as the first layer
`:g+=`- Swap to ${L.name} at a layer height of ${Math.round((s.paint.filaments[y-1].endHeight+parseFloat(x0.value))*100)/100} mm
`}let d=`Generated by painter.vec4.ca.

Filament Library:
${h}
        
Print Instructions:
Set base layer height to ${d9.value} mm and layer height to ${x0.value} mm.
${g}`;u9.innerHTML=d,C0("Filament Painter Instructions.txt",d)})}function C0(t,e){const n=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}function p9(){var t=document.getElementById("export-project");t.addEventListener("click",h9)}function h9(){const t=s.paint.sourceImage.src,e=document.getElementById("height-option-selection"),n=document.getElementById("layer-height-input"),o=document.getElementById("base-layer-height-input"),r=i0(),a=document.getElementById("image-resolution-x"),l=document.getElementById("image-resolution-y"),h=document.getElementById("detail-size"),g=document.getElementById("physical-x"),d=document.getElementById("physical-y");C0("project.json",JSON.stringify({imageData:t,heightOptionSelection:e.value,globalLayerHeightInput:n.value,baseLayerHeight:o.value,layers:r,imageResolutionX:a.value,imageResolutionY:l.value,detailSizeInput:h.value,physicalXInput:g.value,physicalYInput:d.value}))}r9();const f9=document.getElementById("image-resolution-x"),v9=document.getElementById("image-resolution-y"),b0=document.getElementById("physical-x");U0("image-upload",t=>{t.error?console.error("Image upload error:",t.error):t.imageElement&&(s.paint.image=t.imageElement,s.paint.sourceImage=t.imageElement,f9.value=`${s.paint.image.width}`,v9.value=`${s.paint.image.height}`,b0.value="100",a0(b0),l0())});o9();n9();const g0=document.getElementById("base-layer-height-input"),R0=document.getElementById("end-layer-height-label");g0.addEventListener("input",()=>{const t=i0();let e=parseFloat(g0.value);for(let n=0;n<t.length;n++)e+=t[n].layerHeight;R0.innerHTML=`End Height: ${e.toString()} mm`});document.addEventListener("DOMContentLoaded",()=>{D0(t=>{const e=i0();let n=parseFloat(g0.value);for(let o=0;o<e.length;o++)n+=e[o].layerHeight;n=Math.round(n*100)/100,R0.innerHTML=`End Height: ${n.toString()} mm`,O()})});g9();p9();var L0;(L0=document.getElementById("buy-commercial"))==null||L0.addEventListener("click",()=>{window.open("https://ko-fi.com/s/1d20470ee2","_blank")});</script>
  <style rel="stylesheet" crossorigin>body{margin:0;font-family:sans-serif;display:flex;flex-direction:column;max-height:100vh;overflow:hidden;min-width:60rem;background-color:#121212;color:#e0e0e0;scrollbar-color:#656565 #373737;font-size:1rem}header{display:flex;flex-direction:row;font-weight:700;padding:0 5rem}.page-header{background-color:#2e2e2e;color:#e0e0e0;padding:.5rem;justify-content:center;height:1.25rem;display:flex;gap:1rem;align-items:end;flex-direction:row}.page-header a{color:#96c8fb;text-decoration:none;font-weight:400}.page-header h1{margin:0;font-size:1rem;font-weight:400}.container{display:grid;grid-template-columns:30rem auto;flex-grow:1;overflow:hidden}.config-sidebar{background-color:#272727;padding:1rem;height:calc(100vh - 2.5rem);overflow-y:auto;border-right:1px solid #333}.config-sidebar nav{display:flex;flex-direction:column;gap:1rem}.config-sidebar nav ul{list-style:none;padding:0;margin:0}.config-sidebar nav li{margin-bottom:.5rem}.config-sidebar nav a{text-decoration:none;color:#ccc;display:block;padding:.3125rem 0}.config-sidebar nav a:hover{background-color:#333}.preview-window{flex-grow:1;display:flex;flex-direction:column;overflow:auto;gap:1rem;padding:1.25rem 2.75rem 1.25rem 1.25rem;height:calc(100vh - 2.5rem);background-color:#1e1e1e;position:relative;width:30vw}.preview-window{-ms-overflow-style:none;scrollbar-width:none}.preview-window::-webkit-scrollbar{display:none}.preview-canvas{border:1px solid #444;height:auto}.draggable-list{list-style:none;padding:0;margin:0}.draggable-item{background-color:#333;border:.0625rem solid #444;padding:.625rem;margin-bottom:.3125rem;-webkit-user-select:none;user-select:none;color:#ccc;display:flex;flex-direction:column;gap:.5rem}.drag-handle{cursor:grab;margin-right:.625rem;display:inline-block;vertical-align:middle;font-size:1rem;border-radius:.325rem}.row{display:flex;align-items:center;margin-top:.3125rem}.row span{display:flex;gap:.5rem}.row input[type=text],.row input[type=number]{padding:.3125rem;border:.0625rem solid #555;background-color:#444;color:#ccc;border-radius:.125rem}.row input[type=number]{width:4rem}input[type=number]{padding:.3125rem;border:.0625rem solid #555;background-color:#444;color:#ccc;border-radius:.125rem}.dragging{opacity:.5}.filament-add-button{margin-bottom:.625rem;cursor:pointer;padding:.3125rem .625rem;background-color:#444;color:#ccc;border:none}h2{margin:1rem 0;color:#ccc}h3{margin:.5rem 0;color:#ccc}.inline-div{display:flex;gap:1rem}.input-number{width:4rem;background-color:#444;color:#ccc;border:1px solid #555}input,select,textarea{background-color:#444;color:#ccc;border:1px solid #555}select option{background-color:#333;color:#ccc}.resize-handle{position:absolute;top:0;right:0;width:1.5rem;height:100%;background:#555;cursor:grab;display:flex;align-items:center;justify-content:center;color:#ccc;font-weight:lighter;font-size:1rem;writing-mode:vertical-rl;text-orientation:mixed;border-radius:.625rem}.resize-handle:active{cursor:grabbing}button{background-color:#8f8f8f7d;color:#e1e1e1;padding:10px 20px;border-radius:6px;border:none;cursor:pointer;transition:background .15s,color .15s;font-size:1rem}button:hover{background-color:#6c6c6c;color:#e6e6e6}button:active{background-color:#404040;color:#b1b1b1}.image-input{background-color:#333;color:#eee;border:1px solid #555;padding:8px 12px;border-radius:4px;cursor:pointer}.image-input:hover{background-color:#444;border-color:#666}.image-input:focus{outline:none;border-color:#777;box-shadow:0 0 5px #77777780}input{font-size:1rem}input[type=file]::file-selector-button{background-color:#595959;color:#eee;border:1px solid #555;padding:8px 12px;border-radius:4px;cursor:pointer;transition:background-color .2s ease-in-out,border-color .2s ease-in-out}input[type=file]::file-selector-button:hover{background-color:#444;border-color:#666}input[type=file]::file-selector-button:focus{outline:none;border-color:#777;box-shadow:0 0 5px #77777780}.filament-list-item{background-color:#333;padding:1rem;display:flex;flex-direction:column;gap:.5rem;font-size:1rem;border-radius:.625rem}.h-divider{width:100%;height:2px;background-color:#9e9e9e}.h-gap{width:1rem}.h-gap-small{width:.6rem}input[type=range]{cursor:pointer}.import-option-row{display:flex;flex-direction:column;gap:.5rem;font-size:1rem}select{font-size:.9rem;padding:.3rem;border-radius:.225rem}button:disabled,button[disabled]{background-color:#333;color:#ccc}button:disabled,button[disabled]:hover{background-color:#333;color:#ccc}button:disabled,button[disabled]:active{background-color:#333;color:#ccc}textarea{font-family:serif;font-size:.9rem}#buy-commercial{background-color:#396042}</style>
</head>

<body>
    <header class="page-header">
        <div><a href="https://github.com/hpnrep6/FilamentPainter" target="_blank">Github Repo</a></div>
        <div class="h-gap"></div>
        <div>Filament Painter</div>
        <div class="h-gap"></div>
        <h1>painter.vec4.ca</h1>
        <div class="h-gap"></div>
        <div><a href="https://www.youtube.com/watch?v=DBM5WOLuUQk" target="_blank">ℹ️ Click here for a tutorial on how
                to use this website</a></div>
    </header>
    <div class="container">
        <aside class="config-sidebar">
            <nav>
                <h2>
                    Import Options
                </h2>
                <div class="import-option-row">
                    <label> Import Image: </label>
                    <input id="image-upload" type="file" name="file" accept="image/*" class="image-input">
                </div>
                <div class="h-divider"></div>
                <h2>
                    Filament Options
                </h2>

                <div>
                    <label for="height-option-selection">Topography Function: </label>

                    <select name="height-option" id="height-option-selection">
                        <option value="nearest">Nearest Match</option>
                        <option value="greyscale-luminance">Greyscale (Luminance)</option>
                        <option value="greyscale-max">Greyscale (Max)</option>
                        <option value="custom" disabled>Custom (In Development)</option>
                    </select>
                </div>


                <div>
                    <label>Layer height: </label>
                    <input class="input-number" id="layer-height-input" type="number" step="0.01" value="0.08" /> mm
                </div>

                <div>
                    <label>Base layer height: </label>
                    <input class="input-number" id="base-layer-height-input" type="number" step="0.01" value="0.2" /> mm
                </div>
                <div class="h-divider"></div>
                <h3>
                    Add New Filament Layer
                </h3>

                <ul>
                    <li class="filament-list-item">
                        <span>Create New Filament</span>
                        <div class="row">
                            <span>Name: <input type="text" value="Filament 1" /></span>
                        </div>
                        <div class="row">
                            <span>Colour: <input type="color" /> <input type="text" placeholder="Hex Code" /></span>
                        </div>
                        <div class="row">
                            <span>Opacity: <input type="number" step="0.01" min="0" max="5" value="0.1" /> mm</span>
                        </div>
                        <button class="filament-add-button" id="add-item-button-new">Add Filament Layer</button>
                    </li>

                    <li class="filament-list-item">
                        <span>Choose Existing Filament</span>
                        <select id="existing-filament-selection">
                            <option value="None">Choose an existing filament</option>
                        </select>
                        <button class="filament-add-button" id="add-item-button-existing">Add Filament Layer</button>
                    </li>
                </ul>

                <div class="h-divider">
                </div>
                <h3>Layers</h3>

                <div class="row filament-list-item" id="end-layer-height-label">
                    End height: 0.2 mm
                </div>
                <ul class="draggable-list" id="draggable-list">
                    <!--                    <li class="draggable-item">-->
                    <!--                        <div class="drag-handle">-->
                    <!--                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">-->
                    <!--                                <path d="M3 9H21V11H3V9ZM3 15H21V17H3V15Z" fill="currentColor"/>-->
                    <!--                            </svg>-->
                    <!--                        </div>-->
                    <!--                        <div class="row">-->
                    <!--                            <span>Name: <input type="text" value="Filament 1" readonly/></span>-->
                    <!--                        </div>-->
                    <!--                        <div class="row">-->
                    <!--                            Colour: <div class="h-gap-small"></div> <input type="color" disabled/>-->
                    <!--                            <div class="h-gap"></div>-->
                    <!--                            Opacity: <div class="h-gap-small"></div> <input type="number" step="0.01" min="0" max="5"/>-->
                    <!--                        </div>-->
                    <!--                        <div class="row">-->
                    <!--                            Layer Height:-->
                    <!--                            <div class="h-gap-small"></div>-->
                    <!--                            <input type="range" min="0.01" max="1" step="0.01" value="0.2">-->
                    <!--                            <div class="h-gap"></div>-->
                    <!--                            <input type="number" min="0.01" max="1" step="0.01" value="0.2">-->
                    <!--                            <div class="h-gap-small"></div> mm-->
                    <!--                        </div>-->
                    <!--                    </li>-->
                    <!--                    <li class="draggable-item">-->
                    <!--                        <div class="drag-handle">-->
                    <!--                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">-->
                    <!--                                <path d="M3 9H21V11H3V9ZM3 15H21V17H3V15Z" fill="currentColor"/>-->
                    <!--                            </svg>-->
                    <!--                        </div>-->
                    <!--                        <div class="row">-->
                    <!--                            <span>Name: <input type="text" value="Filament 1" readonly/></span>-->
                    <!--                        </div>-->
                    <!--                        <div class="row">-->
                    <!--                            Colour: <div class="h-gap-small"></div> <input type="color" disabled/>-->
                    <!--                            <div class="h-gap"></div>-->
                    <!--                            Opacity: <div class="h-gap-small"></div> <input type="number" step="0.01" min="0" max="5"/>-->
                    <!--                        </div>-->
                    <!--                        <div class="row">-->
                    <!--                            Layer Height:-->
                    <!--                            <div class="h-gap-small"></div>-->
                    <!--                            <input type="range" min="0.01" max="1" step="0.01" value="0.2">-->
                    <!--                            <div class="h-gap"></div>-->
                    <!--                            <input type="number" min="0.01" max="1" step="0.01" value="0.2">-->
                    <!--                            <div class="h-gap-small"></div> mm-->
                    <!--                        </div>-->
                    <!--                    </li>-->
                </ul>
                <div class="row filament-list-item">
                    Build Plate: 0 mm
                </div>

                <div class="h-divider"></div>
                <h3>
                    Library
                </h3>

                <ul id="existing-filament-list">
                    <!--                    <li class="filament-list-item">-->
                    <!--                        <span>Filament 1</span>-->
                    <!--                        <div class="row">-->
                    <!--                            <span>Title: <input type="text" value="Filament 1"/></span>-->
                    <!--                        </div>-->
                    <!--                        <div class="row">-->
                    <!--                            <span>Color: <input type="color"/> <input type="text" placeholder="Hex Code"/></span>-->
                    <!--                        </div>-->
                    <!--                        <div class="row">-->
                    <!--                            <span>Opacity: <input type="number" step="0.01" min="0" max="1"/> mm</span>-->
                    <!--                        </div>-->
                    <!--                    </li>-->
                    <!--                    <li class="filament-list-item">-->
                    <!--                        <span>Filament 1</span>-->
                    <!--                        <div class="row">-->
                    <!--                            <span>Title: <input type="text" value="Filament 1"/></span>-->
                    <!--                        </div>-->
                    <!--                        <div class="row">-->
                    <!--                            <span>Color: <input type="color"/> <input type="text" placeholder="Hex Code"/></span>-->
                    <!--                        </div>-->
                    <!--                        <div class="row">-->
                    <!--                            <span>Opacity: <input type="number" step="0.01" min="0" max="1"/> mm</span>-->
                    <!--                        </div>-->
                    <!--                    </li>-->
                </ul>

                <button id="update-painting-button">Update Painting</button>
                <div>
                    <input type="checkbox" checked id="auto-update-checkbox" />
                    Automatically Update Painting
                </div>

                <div class="h-divider"></div>
                <h2>
                    Export Options
                </h2>

                <div>
                    <label>Image Resolution:</label>
                    w <input class="input-number" type="number" id="image-resolution-x" readonly /> px by h <input
                        class="input-number" type="number" id="image-resolution-y" readonly /> px
                </div>

                <div class="row">
                    <label>Detail Size: </label>
                    <div class="h-gap-small"></div>
                    <input class="input-number" type="number" step="0.05" value="0.2" min="0.05" id="detail-size" />
                    <div class="h-gap-small"></div>
                    mm
                </div>


                <div>
                    <label>Physical Size:</label>
                    w <input class="input-number" type="number" id="physical-x" min="1" /> mm by h <input
                        class="input-number" type="number" id="physical-y" min="1" /> mm
                </div>

                <span id="file-size-estimate">
                    Estimated File Size:
                </span>

                <div class="inline-div">
                    <h3>Print Instructions</h3>
                    <!--                    <select name="language-option" id="language-option-selection">-->
                    <!--                        <option value="nearest">English</option>-->
                    <!--                        <option value="greyscale-luminance">Greyscale (Luminance)</option>-->
                    <!--                        <option value="greyscale-max">Greyscale (Max)</option>-->
                    <!--                        <option value="custom" disabled >Custom (In Development)</option>-->
                    <!--                    </select>-->
                </div>
                <textarea id="instructions" rows="30"></textarea>

                ℹ️ Notice: This software is only free for non-commercial use.
                <br></br>
                If you would like to purchase a commercial license, click the button below.
                <button id="buy-commercial">Buy Commercial License ($20)</button>
                <button id="export-stl">Export as STL</button>
                <button id="export-project">Export as Project (In Development)</button>
                <br></br>
                <a href="https://github.com/hpnrep6/FilamentPainter" target="_blank">Check out the source code on
                    GitHub.</a>
                <a href="https://www.reddit.com/r/FilamentPainter" target="_blank">Join the Filament Painter
                    subreddit.</a>
                <a>For any inquiries, please contact: hpnrep9@gmail.com</a>
                <div class="h-gap"></div>
                <div class="h-gap"></div>
            </nav>
        </aside>
        <main class="preview-window">
            <canvas id="canvas-preview" class="preview-canvas"></canvas>
            <canvas id="canvas-source" class="preview-canvas"></canvas>
            <div>
                <h2></h2>
            </div>
            <div class="resize-handle">Drag to Resize</div>
        </main>
    </div>

</body>

</html>